        /* --- 1. THE JOYFUL PALETTE --- */
        :root {
            --primary: #00cec9;       /* Turchese Vacanza */
            --primary-dark: #00b894;
            --accent: #ff7675;        /* Corallo Tramonto */
            --bg-light: #f4f7f6;      /* Grigio "Nuvola" */
            --text-dark: #2d3436;     /* Grigio Antracite */
            --text-light: #636e72;
            --white: #ffffff;
            --shadow-soft: 0 10px 25px rgba(0,0,0,0.05);
            --shadow-hover: 0 15px 35px rgba(0,0,0,0.1);
        }

        /* --- RESET & BASE --- */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', 'Segoe UI', sans-serif; }
        body { 
            height: 100vh; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
            background: var(--bg-light); 
            color: var(--text-dark);
        }

        /* --- ZONA 1: UPPER DECK (60%) --- */
        .upper-deck {
            flex: 6; 
            display: flex;
            background: var(--white);
            box-shadow: 0 4px 20px rgba(0,0,0,0.03); 
            z-index: 10;
            min-height: 0; /* FIX IMPORTANTE: Impedisce espansione indesiderata */
            overflow: hidden;
        }

        /* 1A. Ricerca (Sinistra) */
        .search-panel {
            width: 340px;
            background: var(--white);
            display: flex;
            flex-direction: column;
            border-right: 1px solid #eee;
            min-height: 0; /* Permette lo scroll interno */
        }

        /* Header fisso nella sidebar */
        .search-header {
            padding: 20px;
            flex-shrink: 0;
            background: white;
            z-index: 2;
        }

        .search-header h2 { font-size: 18px; margin-bottom: 15px; color: var(--text-dark); display: flex; align-items: center; gap: 8px;}
        
        .search-box-wrapper { position: relative; margin-bottom: 15px; }
        .search-input { 
            width: 100%; padding: 12px 15px 12px 40px; 
            background: var(--bg-light); border: none; 
            border-radius: 12px; font-size: 14px; outline: none; transition: 0.2s;
        }
        .search-input:focus { background: white; box-shadow: 0 0 0 2px var(--primary); }
        .search-icon { position: absolute; left: 12px; top: 12px; color: #aaa; }

        /* Filtri */
        .filters { display: flex; gap: 8px; flex-wrap: wrap; }
        .filter-pill { 
            padding: 6px 14px; background: white; border: 1px solid #eee; 
            border-radius: 20px; font-size: 12px; color: var(--text-light); 
            cursor: pointer; transition: 0.2s; font-weight: 500;
        }
        .filter-pill:hover { border-color: var(--primary); color: var(--primary); }
        .filter-pill.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 10px rgba(0, 206, 201, 0.3); }

        /* Lista Risultati Scrollabile */
        .results-list { 
            flex: 1; 
            overflow-y: auto; 
            padding: 0 20px 20px 20px; /* Padding interno alla scroll area */
        }
        
        .res-card {
            background: var(--white); padding: 12px; margin-bottom: 12px; 
            border-radius: 12px; border: 1px solid #f0f0f0;
            display: flex; gap: 12px; cursor: grab; transition: all 0.2s ease;
        }
        .res-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-soft); border-color: var(--primary); }
        .res-img { width: 50px; height: 50px; background: #eee; border-radius: 10px; flex-shrink: 0; object-fit: cover; }
        .res-info h4 { font-size: 14px; margin-bottom: 2px; }
        .res-info small { font-size: 12px; color: var(--text-light); }
        .rating-badge { font-size: 11px; font-weight: bold; color: #fdcb6e; background: #fffbf0; padding: 2px 6px; border-radius: 4px; display: inline-block; margin-top: 4px; }

        /* 1B. La Mappa (Destra) */
        .map-stage {
            flex: 1; position: relative;
            background: #eef2f3; 
            background-image: radial-gradient(#cbd5e0 1px, transparent 1px);
            background-size: 30px 30px;
        }
        
        .map-controls { position: absolute; top: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px; }
        .btn-map { 
            background: var(--white); color: var(--text-dark); width: 40px; height: 40px; border: none;
            cursor: pointer; display: flex; align-items: center; justify-content: center; 
            border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.1); font-size: 18px; transition: 0.2s;
        }
        .btn-map:hover { transform: scale(1.1); color: var(--primary); }

        /* Pin Animati */
        .pin {
            position: absolute; width: 36px; height: 36px;
            background: var(--accent); border: 2px solid white;
            border-radius: 50% 50% 50% 0; transform: rotate(-45deg);
            display: flex; align-items: center; justify-content: center; 
            color: white; font-weight: bold;
            box-shadow: 0 5px 15px rgba(255, 118, 117, 0.4);
            animation: bounce 2s infinite;
        }
        .pin-content { transform: rotate(45deg); font-size: 14px; }
        @keyframes bounce { 0%, 100% {transform: rotate(-45deg) translateY(0);} 50% {transform: rotate(-45deg) translateY(-5px);} }

        /* --- ZONA 2: LOWER DECK (TIMELINE 40%) --- */
        .timeline-deck {
            flex: 4; 
            background: var(--bg-light); 
            display: flex; flex-direction: column;
            border-top: 1px solid white;
            min-height: 0; /* FIX IMPORTANTE */
            overflow: hidden;
        }

        .timeline-header {
            padding: 15px 30px;
            display: flex; justify-content: space-between; align-items: center;
            background: var(--bg-light);
            flex-shrink: 0;
        }
        .trip-title h1 { font-size: 20px; color: var(--text-dark); }
        .trip-meta { font-size: 13px; color: var(--text-light); background: white; padding: 5px 12px; border-radius: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        .timeline-track {
            flex: 1; display: flex; overflow-x: auto;
            padding: 0 30px 30px 30px; gap: 25px; align-items: flex-start;
        }
        /* Scrollbar styling */
        .timeline-track::-webkit-scrollbar { height: 8px; }
        .timeline-track::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 4px; }
        .timeline-track::-webkit-scrollbar-track { background: transparent; }

        /* Blocchi Giorni */
        .day-block {
            min-width: 320px; background: var(--white);
            border-radius: 16px; box-shadow: var(--shadow-soft);
            display: flex; flex-direction: column;
            height: 95%; border: 1px solid #fff;
            position: relative; overflow: hidden;
        }
        
        .day-header {
            padding: 15px; background: linear-gradient(to right, #ffffff, #f9f9f9);
            border-bottom: 1px solid #f0f0f0;
            display: flex; justify-content: space-between; align-items: center;
            flex-shrink: 0;
        }
        .day-num { font-weight: 700; color: var(--text-dark); font-size: 16px; }
        .day-date { font-size: 12px; color: var(--primary); font-weight: 600; background: rgba(0, 206, 201, 0.1); padding: 4px 10px; border-radius: 10px; }

        .day-slots {
            flex: 1; padding: 15px; overflow-y: auto;
            background-image: linear-gradient(#f4f7f6 1px, transparent 1px);
            background-size: 100% 40px;
        }

        /* Items */
        .plan-item {
            background: white; border: 1px solid #eee; padding: 10px;
            margin-bottom: 25px; border-radius: 12px;
            position: relative; display: flex; align-items: center; gap: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02); z-index: 2;
        }
        .plan-time { font-size: 12px; font-weight: bold; color: var(--primary); background: rgba(0, 206, 201, 0.1); padding: 4px 8px; border-radius: 6px; }
        
        /* Connettori */
        .connector-line {
            position: absolute; bottom: -26px; left: 24px;
            width: 2px; height: 26px; border-left: 2px dashed #dcdde1; z-index: 1;
        }
        .walk-badge {
            position: absolute; bottom: -20px; left: 35px;
            font-size: 10px; color: #aaa; background: rgba(255,255,255,0.8); white-space: nowrap;
        }
        .empty-day { text-align: center; color: #b2bec3; font-size: 13px; margin-top: 40px; }

<!doctype html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Progetto Segretissimo - Google Map</title>
    <link rel="icon" type="image/svg+xml" href="/icon.png" />
    <link rel="stylesheet" href="/css/styles.css" />
    <style>
      /* fallback style for the map container */
      #map { height: 100vh; width: 100%; }
      body, html { margin: 0; padding: 0; height: 100%; }
    </style>
  </head>
  <body>
    <div id="app">
      <aside id="sidebar">
        <h2>Ricerca Cibo</h2>
        <div id="controls">
          <button id="clear-circle" aria-label="Rimuovi cerchio">Rimuovi cerchio</button>
          <button id="export-json" aria-label="Esporta lista">Esporta JSON</button>
          <button id="refresh-search" aria-label="Ricerca di nuovo">Ricerca di nuovo</button>
          
          <!-- Configurazione tipi di cibo -->
          <div style="margin-top: 10px; padding: 10px; background: #f9f9f9; border-radius: 5px;">
            <label for="included-types" style="display: block; margin-bottom: 5px; font-weight: bold;">Tipi inclusi (comma-separated):</label>
            <input type="text" id="included-types" value="restaurant,cafe,bar" style="width: 100%; padding: 5px; margin-bottom: 10px;">
            
            <label for="excluded-types" style="display: block; margin-bottom: 5px; font-weight: bold;">Tipi esclusi (comma-separated):</label>
            <input type="text" id="excluded-types" value="" style="width: 100%; padding: 5px; margin-bottom: 10px;">
          </div>
          
          <small>Disegna un cerchio sulla mappa per cercare cibo</small>
          <div id="map-status" class="map-status">Stato mappa: <strong id="map-status-text">In attesa...</strong></div>
          <div id="circle-info">
            <div>Centro: <span id="circle-coords">—</span></div>
            <div>Raggio (m): <span id="circle-radius">—</span></div>
          </div>
        </div>
        <ul id="places-list" aria-live="polite"></ul>
      </aside>
      <main id="map-container">
        <div id="map"></div>
        <div id="map-placeholder" class="map-placeholder">Caricamento mappa... Se vedi questo testo, la Google Maps JS non ha caricato correttamente.</div>
        <div id="map-actions" class="map-actions">
          <button id="reload-map" aria-label="Ricarica mappa">Ricarica mappa</button>
        </div>
        <!-- Risposta JSON API -->
        <div id="api-response-container" style="position: absolute; bottom: 10px; left: 10px; right: 10px; background: rgba(0,0,0,0.8); color: #0f0; padding: 10px; border-radius: 5px; max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 11px; display: none; z-index: 500;">
          <pre id="api-response-text"></pre>
        </div>
      </main>
    </div>
      <div id="map-overlay" role="alert" aria-live="polite" style="display:none;">
        <div class="overlay-content">
          <h3>Google Maps non è stato caricato</h3>
          <p>Imposta la chiave API Google Maps in `.env` (GOOGLE_MAPS_API_KEY) e riavvia il server.</p>
        </div>
      </div>
    <!-- Load local script first to define initMap, then load Google Maps JS API with callback -->
    <script src="/js/map.js"></script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=<%= apiKey %>&callback=initMap&libraries=drawing,places&v=weekly"
      async
      defer
      onerror="window.mapLoadError && window.mapLoadError()"
    ></script>
  </body>
  </html>

<!doctype html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Progetto Segretissimo - Google Map</title>
    <link rel="icon" type="image/svg+xml" href="/icon.png" />
    <link rel="stylesheet" href="/css/styles.css" />
    <style>
      /* fallback style for the map container */
      #map { height: 100vh; width: 100%; }
      body, html { margin: 0; padding: 0; height: 100%; }
    </style>
  </head>
  <body>
    <div id="app">
      <aside id="sidebar">
        <h1>Beyond the travel</h1>
        <div id="controls">
          <button id="clear-circle" aria-label="Rimuovi cerchio">Rimuovi cerchio</button>
          <button id="export-report" aria-label="Genera report PDF">üìÑ Genera Report PDF</button>
          <button id="refresh-search" aria-label="Ricerca di nuovo">Ricerca di nuovo</button>
          <button id="toggle-api-response" aria-label="Mostra/Nascondi risposte API">üîç Debug API</button>
          
          <!-- Filtri per colore -->
          <div class="control-section">
            <label>üé® Filtri per colore</label>
            <div id="color-filters">
              <button class="color-filter-btn" data-color="all">Tutti</button>
              <button class="color-filter-btn" data-color="#d32f2f" style="background: #d32f2f; color: white;">Ristoranti</button>
              <button class="color-filter-btn" data-color="#1976d2" style="background: #1976d2; color: white;">Cafe</button>
              <button class="color-filter-btn" data-color="#388e3c" style="background: #388e3c; color: white;">Storia</button>
              <button class="color-filter-btn" data-color="#7b1fa2" style="background: #7b1fa2; color: white;">Musei</button>
              <button class="color-filter-btn" data-color="#f57c00" style="background: #f57c00; color: white;">Natura</button>
              <button class="color-filter-btn" data-color="#00897b" style="background: #00897b; color: white;">Divert.</button>
            </div>
          </div>
          
          <!-- Controllo Raggio Massimo -->
          <div class="control-section">
            <label>üìè Raggio massimo cerchio</label>
            <select id="max-radius-selector">
              <option value="5000">5 km</option>
              <option value="10000">10 km</option>
              <option value="25000" selected>25 km</option>
              <option value="50000">50 km (massimo Google)</option>
            </select>
          </div>
          
          <!-- Configurazione 9 ricerche diverse -->
          <div class="control-section">
            <label>‚öôÔ∏è Configurazione 9 ricerche parallele</label>
            
            <div class="search-config-group">
              <strong style="color: #d32f2f;">Ricerca 1-4 (Sottocerchi)</strong>
              <div class="search-item">
                <input type="text" class="search-config" data-search="1" data-type="included" placeholder="Tipi inclusi">
                <input type="text" class="search-config" data-search="1" data-type="excluded" placeholder="Tipi esclusi">
              </div>
              <div class="search-item">
                <input type="text" class="search-config" data-search="2" data-type="included" placeholder="Tipi inclusi">
                <input type="text" class="search-config" data-search="2" data-type="excluded" placeholder="Tipi esclusi">
              </div>
              <div class="search-item">
                <input type="text" class="search-config" data-search="3" data-type="included" placeholder="Tipi inclusi">
                <input type="text" class="search-config" data-search="3" data-type="excluded" placeholder="Tipi esclusi">
              </div>
              <div class="search-item">
                <input type="text" class="search-config" data-search="4" data-type="included" placeholder="Tipi inclusi">
                <input type="text" class="search-config" data-search="4" data-type="excluded" placeholder="Tipi esclusi">
              </div>
            </div>
            
            <div class="search-config-group">
              <strong style="color: #1976d2;">Ricerca 5-9 (Cerchio principale)</strong>
              <div class="search-item">
                <input type="text" class="search-config" data-search="5" data-type="included" placeholder="Tipi inclusi">
                <input type="text" class="search-config" data-search="5" data-type="excluded" placeholder="Tipi esclusi">
              </div>
              <div class="search-item">
                <input type="text" class="search-config" data-search="6" data-type="included" placeholder="Tipi inclusi">
                <input type="text" class="search-config" data-search="6" data-type="excluded" placeholder="Tipi esclusi">
              </div>
              <div class="search-item">
                <input type="text" class="search-config" data-search="7" data-type="included" placeholder="Tipi inclusi">
                <input type="text" class="search-config" data-search="7" data-type="excluded" placeholder="Tipi esclusi">
              </div>
              <div class="search-item">
                <input type="text" class="search-config" data-search="8" data-type="included" placeholder="Tipi inclusi">
                <input type="text" class="search-config" data-search="8" data-type="excluded" placeholder="Tipi esclusi">
              </div>
              <div class="search-item">
                <input type="text" class="search-config" data-search="9" data-type="included" placeholder="Tipi inclusi">
                <input type="text" class="search-config" data-search="9" data-type="excluded" placeholder="Tipi esclusi">
              </div>
            </div>
          </div>
          
          <small>Disegna un cerchio sulla mappa per cercare luoghi interessanti</small>
          <div id="map-status" class="map-status">Stato mappa: <strong id="map-status-text">In attesa...</strong></div>
          <div id="circle-info">
            <div>Centro: <span id="circle-coords">‚Äî</span></div>
            <div>Raggio (m): <span id="circle-radius">‚Äî</span></div>
          </div>
        </div>
        <div id="duplicates-info" style="margin-top: 10px; padding: 10px; background: #fff9e6; border-radius: 5px; border-left: 4px solid #ff9800; display: none;">
          <strong style="display: block; margin-bottom: 5px;">‚ö†Ô∏è Analisi Duplicati:</strong>
          <div id="duplicates-content" style="font-size: 0.85rem; line-height: 1.5;"></div>
        </div>
        <ul id="places-list" aria-live="polite"></ul>
      </aside>
      <main id="map-container">
        <div id="map"></div>
        <div id="map-placeholder" class="map-placeholder">Caricamento mappa... Se vedi questo testo, la Google Maps JS non ha caricato correttamente.</div>
        <div id="map-actions" class="map-actions">
          <button id="reload-map" aria-label="Ricarica mappa">Ricarica mappa</button>
        </div>
        <!-- Risposta JSON API -->
        <div id="api-response-container" style="position: absolute; bottom: 10px; left: 10px; right: 10px; background: rgba(0,0,0,0.8); color: #0f0; padding: 10px; border-radius: 5px; max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 11px; display: none; z-index: 500;">
          <pre id="api-response-text"></pre>
        </div>
      </main>
    </div>
      <div id="map-overlay" role="alert" aria-live="polite" style="display:none;">
        <div class="overlay-content">
          <h3>Google Maps non √® stato caricato</h3>
          <p>Imposta la chiave API Google Maps in `.env` (GOOGLE_MAPS_API_KEY) e riavvia il server.</p>
        </div>
      </div>
    <!-- Load jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        window.GOOGLE_MAPS_API_KEY = "<%= apiKey %>";
    </script>
    <!-- Load modular JavaScript files -->
    <script src="/js/config.js"></script>
    <script src="/js/geometry.js"></script>
    <script src="/js/ui.js"></script>
    <script src="/js/markers.js"></script>
    <script src="/js/duplicates.js"></script>
    <script src="/js/pdf-report.js"></script>
    <script src="/js/map-enhancements.js"></script>
    <script src="/js/search.js"></script>
    <script src="/js/map.js"></script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=<%= apiKey %>&callback=initMap&libraries=drawing,places&v=weekly"
      async
      defer
      onerror="window.mapLoadError && window.mapLoadError()"
    ></script>
  </body>
  </html>

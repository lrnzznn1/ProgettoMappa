<!doctype html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Progetto Segretissimo - Google Map</title>
    <link rel="icon" type="image/svg+xml" href="/icon.png" />
    <link rel="stylesheet" href="/css/styles.css" />
    <style>
      /* fallback style for the map container */
      #map { height: 100vh; width: 100%; }
      body, html { margin: 0; padding: 0; height: 100%; }
    </style>
  </head>
  <body>
    <div id="app">
      <aside id="sidebar">
        <h2>Ricerca Cibo</h2>
        <div id="controls">
          <button id="clear-circle" aria-label="Rimuovi cerchio">Rimuovi cerchio</button>
          <button id="export-json" aria-label="Esporta lista">Esporta JSON</button>
          <button id="refresh-search" aria-label="Ricerca di nuovo">Ricerca di nuovo</button>
          <button id="remove-duplicates" aria-label="Rimuovi duplicati">üßπ Rimuovi duplicati</button>
          <button id="restore-duplicates" aria-label="Ripristina tutti" style="display: none;">‚Ü©Ô∏è Ripristina tutti</button>
          
          <!-- Configurazione 6 ricerche diverse -->
          <div style="margin-top: 10px; padding: 10px; background: #f9f9f9; border-radius: 5px; font-size: 0.85rem;">
            <label style="display: block; margin-bottom: 8px; font-weight: bold;">‚öôÔ∏è 6 Ricerche parallele:</label>
            
            <div style="margin-bottom: 8px; padding: 5px; background: #fff; border-radius: 3px;">
              <strong style="display: block; color: #d32f2f;">Ricerca 1:</strong>
              <input type="text" class="search-config" data-search="1" data-type="included" placeholder="inclusi" style="width: 100%; padding: 3px; margin-top: 3px; font-size: 0.8rem;">
              <input type="text" class="search-config" data-search="1" data-type="excluded" placeholder="esclusi" style="width: 100%; padding: 3px; margin-top: 2px; font-size: 0.8rem;">
            </div>
            
            <div style="margin-bottom: 8px; padding: 5px; background: #fff; border-radius: 3px;">
              <strong style="display: block; color: #1976d2;">Ricerca 2:</strong>
              <input type="text" class="search-config" data-search="2" data-type="included" placeholder="inclusi" style="width: 100%; padding: 3px; margin-top: 3px; font-size: 0.8rem;">
              <input type="text" class="search-config" data-search="2" data-type="excluded" placeholder="esclusi" style="width: 100%; padding: 3px; margin-top: 2px; font-size: 0.8rem;">
            </div>
            
            <div style="margin-bottom: 8px; padding: 5px; background: #fff; border-radius: 3px;">
              <strong style="display: block; color: #388e3c;">Ricerca 3:</strong>
              <input type="text" class="search-config" data-search="3" data-type="included" placeholder="inclusi" style="width: 100%; padding: 3px; margin-top: 3px; font-size: 0.8rem;">
              <input type="text" class="search-config" data-search="3" data-type="excluded" placeholder="esclusi" style="width: 100%; padding: 3px; margin-top: 2px; font-size: 0.8rem;">
            </div>
            
            <div style="margin-bottom: 8px; padding: 5px; background: #fff; border-radius: 3px;">
              <strong style="display: block; color: #7b1fa2;">Ricerca 4:</strong>
              <input type="text" class="search-config" data-search="4" data-type="included" placeholder="inclusi" style="width: 100%; padding: 3px; margin-top: 3px; font-size: 0.8rem;">
              <input type="text" class="search-config" data-search="4" data-type="excluded" placeholder="esclusi" style="width: 100%; padding: 3px; margin-top: 2px; font-size: 0.8rem;">
            </div>
            
            <div style="margin-bottom: 8px; padding: 5px; background: #fff; border-radius: 3px;">
              <strong style="display: block; color: #f57c00;">Ricerca 5:</strong>
              <input type="text" class="search-config" data-search="5" data-type="included" placeholder="inclusi" style="width: 100%; padding: 3px; margin-top: 3px; font-size: 0.8rem;">
              <input type="text" class="search-config" data-search="5" data-type="excluded" placeholder="esclusi" style="width: 100%; padding: 3px; margin-top: 2px; font-size: 0.8rem;">
            </div>
            
            <div style="margin-bottom: 8px; padding: 5px; background: #fff; border-radius: 3px;">
              <strong style="display: block; color: #00897b;">Ricerca 6:</strong>
              <input type="text" class="search-config" data-search="6" data-type="included" placeholder="inclusi" style="width: 100%; padding: 3px; margin-top: 3px; font-size: 0.8rem;">
              <input type="text" class="search-config" data-search="6" data-type="excluded" placeholder="esclusi" style="width: 100%; padding: 3px; margin-top: 2px; font-size: 0.8rem;">
            </div>
          </div>
          
          <small>Disegna un cerchio sulla mappa per cercare cibo</small>
          <div id="map-status" class="map-status">Stato mappa: <strong id="map-status-text">In attesa...</strong></div>
          <div id="circle-info">
            <div>Centro: <span id="circle-coords">‚Äî</span></div>
            <div>Raggio (m): <span id="circle-radius">‚Äî</span></div>
          </div>
        </div>
        <div id="duplicates-info" style="margin-top: 10px; padding: 10px; background: #fff9e6; border-radius: 5px; border-left: 4px solid #ff9800; display: none;">
          <strong style="display: block; margin-bottom: 5px;">‚ö†Ô∏è Analisi Duplicati:</strong>
          <div id="duplicates-content" style="font-size: 0.85rem; line-height: 1.5;"></div>
        </div>
        <ul id="places-list" aria-live="polite"></ul>
      </aside>
      <main id="map-container">
        <div id="map"></div>
        <div id="map-placeholder" class="map-placeholder">Caricamento mappa... Se vedi questo testo, la Google Maps JS non ha caricato correttamente.</div>
        <div id="map-actions" class="map-actions">
          <button id="reload-map" aria-label="Ricarica mappa">Ricarica mappa</button>
        </div>
        <!-- Risposta JSON API -->
        <div id="api-response-container" style="position: absolute; bottom: 10px; left: 10px; right: 10px; background: rgba(0,0,0,0.8); color: #0f0; padding: 10px; border-radius: 5px; max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 11px; display: none; z-index: 500;">
          <pre id="api-response-text"></pre>
        </div>
      </main>
    </div>
      <div id="map-overlay" role="alert" aria-live="polite" style="display:none;">
        <div class="overlay-content">
          <h3>Google Maps non √® stato caricato</h3>
          <p>Imposta la chiave API Google Maps in `.env` (GOOGLE_MAPS_API_KEY) e riavvia il server.</p>
        </div>
      </div>
    <!-- Load local script first to define initMap, then load Google Maps JS API with callback -->
    <script src="/js/map.js"></script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=<%= apiKey %>&callback=initMap&libraries=drawing,places&v=weekly"
      async
      defer
      onerror="window.mapLoadError && window.mapLoadError()"
    ></script>
  </body>
  </html>
